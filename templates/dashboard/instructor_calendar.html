<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Teaching Calendar</title>

    <!-- Bootstrap & FullCalendar CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css" rel="stylesheet">

    <style>
      #calendar {
          max-width: 100%;         /* Take full width of container */
          margin: 0 auto;
          height: auto;            /* Let height expand */
          min-height: 700px;       /* Keeps it tall enough */
          background: white;
          padding: 15px;
          border-radius: 8px;
          box-shadow: 0 0 10px rgba(0,0,0,0.1);
          overflow: hidden;        /* ✅ Prevents content from spilling out */
        }

        .fc { 
          max-width: 100%;         /* ✅ Force FullCalendar to respect parent */
        }
    </style>

</head>
<body class="bg-light">

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <a href="{% url 'instructor_dashboard' %}" class="btn btn-outline-primary rounded-pill px-4 py-2">
            ← Back to Dashboard
        </a>
        <h2 class="text-center flex-grow-1 me-5">My Teaching Calendar</h2>
    </div>

    <div class="container my-4">
      <div id="calendar"></div>
    </div>

</div>

<!-- modal for event actions -->
<div class="modal fade" id="eventModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <!-- modal content gets injected by JS -->
    </div>
  </div>
</div>

<!-- FullCalendar & Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const calendarEl = document.getElementById('calendar');

    if (calendarEl) {
        const calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            height: 'auto',
            events: '/dashboard/instructor/calendar/data/',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,listWeek'
            },
            eventDidMount: function(info) {
                new bootstrap.Tooltip(info.el, {
                    title: `${info.event.title} — ${info.event.extendedProps.status}`,
                    placement: 'top',
                    trigger: 'hover',
                    container: 'body'
                });
            },
            eventClick: function(info) {
                const event = info.event;
                const start = new Date(event.start);
                const dateStr = start.toLocaleDateString();
                const timeStr = start.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                const bookingId = event.extendedProps.booking_id;
                const status = event.extendedProps.status;

                let modalHtml = `
                    <div class="modal-header">
                        <h5 class="modal-title">${event.title}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <p><strong>Date:</strong> ${dateStr}</p>
                        <p><strong>Time:</strong> ${timeStr}</p>
                        <p><strong>Status:</strong> ${status}</p>
                    </div>
                    <div class="modal-footer">
                        <a href="/dashboard/reschedule/${bookingId}/" class="btn btn-primary">Reschedule</a>
                `;

                if (status === "booked") {
                    modalHtml += `
                        <form method="post" action="/dashboard/cancel/${bookingId}/" style="display:inline;">
                          <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
                          <button type="submit" class="btn btn-danger">Cancel</button>
                        </form>
                    `;
                }

                modalHtml += `
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                `;

                document.querySelector('#eventModal .modal-content').innerHTML = modalHtml;
                const modal = new bootstrap.Modal(document.getElementById('eventModal'));
                modal.show();
            }
        });

        calendar.render();
    }
});
</script>

</body>
</html>
